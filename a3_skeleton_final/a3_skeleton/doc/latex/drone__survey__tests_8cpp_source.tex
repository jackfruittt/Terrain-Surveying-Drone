\doxysection{drone\+\_\+survey\+\_\+tests.\+cpp}
\hypertarget{drone__survey__tests_8cpp_source}{}\label{drone__survey__tests_8cpp_source}\index{test/drone\_survey\_tests.cpp@{test/drone\_survey\_tests.cpp}}
\mbox{\hyperlink{drone__survey__tests_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <gtest/gtest.h>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <rclcpp/rclcpp.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <rosbag2\_cpp/readers/sequential\_reader.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <rosbag2\_storage/storage\_options.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <rosbag2\_cpp/reader.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <geometry\_msgs/msg/pose\_array.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <nav\_msgs/msg/odometry.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <sensor\_msgs/msg/range.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <grid\_map\_msgs/msg/grid\_map.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <grid\_map\_ros/grid\_map\_ros.hpp>}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00012}00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{terrain__map_8h}{terrain\_map.h}}"{}}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00013}00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{drone__node_8h}{drone\_node.h}}"{}}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00014}00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tsp__solver_8h}{tsp\_solver.h}}"{}}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00015}00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{waypoint__manager_8h}{waypoint\_manager.h}}"{}}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00017}\mbox{\hyperlink{class_drone_unit_test}{00017}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_drone_unit_test}{DroneUnitTest}}\ :\ \textcolor{keyword}{public}\ ::testing::Test\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00018}00018\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00020}\mbox{\hyperlink{class_drone_unit_test_aed77fa3cce90b31a3d8652ac22a12168}{00020}}\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_drone_unit_test_aed77fa3cce90b31a3d8652ac22a12168}{SetUp}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00021}00021\ \ \ \ \ \ \ \ \ rclcpp::init(0,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00022}00022\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{node\_}}\ =\ std::make\_shared<rclcpp::Node>(\textcolor{stringliteral}{"{}test\_node"{}});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00023}00023\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00024}00024\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initialise\ terrain\ map\ for\ testing}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00025}00025\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_af88bf198bc78f4659740044e751d4aec}{terrain\_map\_}}\ =\ std::make\_unique<TerrainMap>(}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{node\_}}-\/>get\_logger(),}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00027}00027\ \ \ \ \ \ \ \ \ \ \ \ \ 0.1,\ \ \textcolor{comment}{//\ 10cm\ resolution}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00028}00028\ \ \ \ \ \ \ \ \ \ \ \ \ 1.0\ \ \ \textcolor{comment}{//\ 1x1m\ initial\ size}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00029}00029\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00030}00030\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00031}00031\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initialise\ TSP\ solver}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00032}00032\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a2b5d87b743962fe8152459e615c4d05f}{tsp\_solver\_}}\ =\ std::make\_unique<TSPSolver>(\mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{node\_}}-\/>get\_logger());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00033}00033\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00035}\mbox{\hyperlink{class_drone_unit_test_ab476165860a22948f594c25290447bd0}{00035}}\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_drone_unit_test_ab476165860a22948f594c25290447bd0}{TearDown}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00036}00036\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_af88bf198bc78f4659740044e751d4aec}{terrain\_map\_}}.reset();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00037}00037\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a2b5d87b743962fe8152459e615c4d05f}{tsp\_solver\_}}.reset();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00038}00038\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{node\_}}.reset();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00039}00039\ \ \ \ \ \ \ \ \ rclcpp::shutdown();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00040}00040\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00045}\mbox{\hyperlink{class_drone_unit_test_a63d986fdc65fc01dc88a19c9034ec3bc}{00045}}\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_drone_unit_test_a63d986fdc65fc01dc88a19c9034ec3bc}{loadROSbagData}}(\textcolor{keyword}{const}\ std::string\&\ bag\_path)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00046}00046\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00047}00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ up\ ROSbag\ reader}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ rosbag2\_storage::StorageOptions\ storage\_options;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ storage\_options.uri\ =\ bag\_path;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ storage\_options.storage\_id\ =\ \textcolor{stringliteral}{"{}sqlite3"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ rosbag2\_cpp::ConverterOptions\ converter\_options;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ converter\_options.input\_serialization\_format\ =\ \textcolor{stringliteral}{"{}cdr"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ converter\_options.output\_serialization\_format\ =\ \textcolor{stringliteral}{"{}cdr"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00055}00055\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ rosbag2\_cpp::Reader\ reader;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ reader.open(storage\_options,\ converter\_options);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ all\ messages}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (reader.has\_next())\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bag\_message\ =\ reader.read\_next();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bag\_message-\/>topic\_name\ ==\ \textcolor{stringliteral}{"{}/drone/gt\_odom"{}})\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ odom\_msg\ =\ std::make\_shared<nav\_msgs::msg::Odometry>();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::Serialization<nav\_msgs::msg::Odometry>\ odom\_serialization;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::SerializedMessage\ serialized\_msg(*bag\_message-\/>serialized\_data);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ odom\_serialization.deserialize\_message(\&serialized\_msg,\ odom\_msg.get());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a29679114c6e9258652e218ee632cfcd7}{odom\_messages\_}}.push\_back(odom\_msg);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bag\_message-\/>topic\_name\ ==\ \textcolor{stringliteral}{"{}/drone/sonar"{}})\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ sonar\_msg\ =\ std::make\_shared<sensor\_msgs::msg::Range>();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::Serialization<sensor\_msgs::msg::Range>\ sonar\_serialization;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::SerializedMessage\ serialized\_msg(*bag\_message-\/>serialized\_data);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sonar\_serialization.deserialize\_message(\&serialized\_msg,\ sonar\_msg.get());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_afcab2edf8426f1162f4d6c87dcb5b632}{sonar\_messages\_}}.push\_back(sonar\_msg);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bag\_message-\/>topic\_name\ ==\ \textcolor{stringliteral}{"{}/mission/goals"{}})\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ goals\_msg\ =\ std::make\_shared<geometry\_msgs::msg::PoseArray>();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::Serialization<geometry\_msgs::msg::PoseArray>\ goals\_serialization;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::SerializedMessage\ serialized\_msg(*bag\_message-\/>serialized\_data);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ goals\_serialization.deserialize\_message(\&serialized\_msg,\ goals\_msg.get());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a9538ad2d7ba7d160932d805070d4be70}{goals\_messages\_}}.push\_back(goals\_msg);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bag\_message-\/>topic\_name\ ==\ \textcolor{stringliteral}{"{}/grid\_map"{}})\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ map\_msg\ =\ std::make\_shared<grid\_map\_msgs::msg::GridMap>();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::Serialization<grid\_map\_msgs::msg::GridMap>\ map\_serialization;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rclcpp::SerializedMessage\ serialized\_msg(*bag\_message-\/>serialized\_data);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ map\_serialization.deserialize\_message(\&serialized\_msg,\ map\_msg.get());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a7f518b5695acc5d1a1b645cae89a1f58}{map\_messages\_}}.push\_back(map\_msg);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_INFO(\mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{node\_}}-\/>get\_logger(),\ \textcolor{stringliteral}{"{}Loaded\ ROSbag\ data:\ \%zu\ odom,\ \%zu\ sonar,\ \%zu\ goals,\ \%zu\ maps"{}},}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a29679114c6e9258652e218ee632cfcd7}{odom\_messages\_}}.size(),\ \mbox{\hyperlink{class_drone_unit_test_afcab2edf8426f1162f4d6c87dcb5b632}{sonar\_messages\_}}.size(),\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_drone_unit_test_a9538ad2d7ba7d160932d805070d4be70}{goals\_messages\_}}.size(),\ \mbox{\hyperlink{class_drone_unit_test_a7f518b5695acc5d1a1b645cae89a1f58}{map\_messages\_}}.size());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !\mbox{\hyperlink{class_drone_unit_test_a29679114c6e9258652e218ee632cfcd7}{odom\_messages\_}}.empty()\ \&\&\ !\mbox{\hyperlink{class_drone_unit_test_afcab2edf8426f1162f4d6c87dcb5b632}{sonar\_messages\_}}.empty();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00098}00098\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(\mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{node\_}}-\/>get\_logger(),\ \textcolor{stringliteral}{"{}Failed\ to\ load\ ROSbag:\ \%s"{}},\ e.what());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00102}00102\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00103}00103\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00105}\mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{00105}}\ \ \ \ \ rclcpp::Node::SharedPtr\ \mbox{\hyperlink{class_drone_unit_test_a122bd9f58ab2c12e5a27c94f1bfa467a}{node\_}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00106}\mbox{\hyperlink{class_drone_unit_test_af88bf198bc78f4659740044e751d4aec}{00106}}\ \ \ \ \ std::unique\_ptr<TerrainMap>\ \mbox{\hyperlink{class_drone_unit_test_af88bf198bc78f4659740044e751d4aec}{terrain\_map\_}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00107}\mbox{\hyperlink{class_drone_unit_test_a2b5d87b743962fe8152459e615c4d05f}{00107}}\ \ \ \ \ std::unique\_ptr<TSPSolver>\ \mbox{\hyperlink{class_drone_unit_test_a2b5d87b743962fe8152459e615c4d05f}{tsp\_solver\_}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00108}00108\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00109}00109\ \ \ \ \ \textcolor{comment}{//\ Loaded\ message\ vectors}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00110}\mbox{\hyperlink{class_drone_unit_test_a29679114c6e9258652e218ee632cfcd7}{00110}}\ \ \ \ \ std::vector<nav\_msgs::msg::Odometry::SharedPtr>\ \mbox{\hyperlink{class_drone_unit_test_a29679114c6e9258652e218ee632cfcd7}{odom\_messages\_}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00111}\mbox{\hyperlink{class_drone_unit_test_afcab2edf8426f1162f4d6c87dcb5b632}{00111}}\ \ \ \ \ std::vector<sensor\_msgs::msg::Range::SharedPtr>\ \mbox{\hyperlink{class_drone_unit_test_afcab2edf8426f1162f4d6c87dcb5b632}{sonar\_messages\_}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00112}\mbox{\hyperlink{class_drone_unit_test_a9538ad2d7ba7d160932d805070d4be70}{00112}}\ \ \ \ \ std::vector<geometry\_msgs::msg::PoseArray::SharedPtr>\ \mbox{\hyperlink{class_drone_unit_test_a9538ad2d7ba7d160932d805070d4be70}{goals\_messages\_}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00113}\mbox{\hyperlink{class_drone_unit_test_a7f518b5695acc5d1a1b645cae89a1f58}{00113}}\ \ \ \ \ std::vector<grid\_map\_msgs::msg::GridMap::SharedPtr>\ \mbox{\hyperlink{class_drone_unit_test_a7f518b5695acc5d1a1b645cae89a1f58}{map\_messages\_}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00114}00114\ \};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00122}\mbox{\hyperlink{drone__survey__tests_8cpp_a2df20e2d0d416ede74f0ffa700e98ba9}{00122}}\ \mbox{\hyperlink{drone__survey__tests_8cpp_a2df20e2d0d416ede74f0ffa700e98ba9}{TEST\_F}}(\mbox{\hyperlink{class_drone_unit_test}{DroneUnitTest}},\ TestGridMapCreation)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00123}00123\ \ \ \ \ \textcolor{comment}{//\ Load\ test\ data\ from\ ROSbag}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00124}00124\ \ \ \ \ std::string\ bag\_path\ =\ \textcolor{stringliteral}{"{}/home/wooboontoo/ros2\_ws/src/a3\_skeleton/test\_data/drone\_survey\_gridmap\_test"{}};\ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00125}00125\ \ \ \ \ ASSERT\_TRUE(loadROSbagData(bag\_path))\ <<\ \textcolor{stringliteral}{"{}Failed\ to\ load\ test\ ROSbag\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00126}00126\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00127}00127\ \ \ \ \ \textcolor{comment}{//\ Ensure\ we\ have\ sufficient\ data}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00128}00128\ \ \ \ \ ASSERT\_GE(odom\_messages\_.size(),\ 10)\ <<\ \textcolor{stringliteral}{"{}Insufficient\ odometry\ data\ for\ testing"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00129}00129\ \ \ \ \ ASSERT\_GE(sonar\_messages\_.size(),\ 10)\ <<\ \textcolor{stringliteral}{"{}Insufficient\ sonar\ data\ for\ testing"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00130}00130\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00131}00131\ \ \ \ \ \textcolor{comment}{//\ Process\ the\ first\ portion\ of\ data\ to\ build\ the\ map}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00132}00132\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ data\_points\_to\_process\ =\ std::min(odom\_messages\_.size(),\ sonar\_messages\_.size());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00133}00133\ \ \ \ \ \textcolor{keywordtype}{int}\ successful\_updates\ =\ 0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00134}00134\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00135}00135\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ data\_points\_to\_process;\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00136}00136\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_x\ =\ odom\_messages\_[i]-\/>pose.pose.position.x;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00137}00137\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_y\ =\ odom\_messages\_[i]-\/>pose.pose.position.y;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00138}00138\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_z\ =\ odom\_messages\_[i]-\/>pose.pose.position.z;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00139}00139\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00140}00140\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Validate\ sonar\ reading}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00141}00141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!std::isnan(sonar\_messages\_[i]-\/>range)\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00142}00142\ \ \ \ \ \ \ \ \ \ \ \ \ !std::isinf(sonar\_messages\_[i]-\/>range)\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ sonar\_messages\_[i]-\/>range\ >\ 0.0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ground\_elevation\ =\ drone\_z\ -\/\ sonar\_messages\_[i]-\/>range;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ terrain\ map}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ terrain\_map\_-\/>updateElevation(drone\_x,\ drone\_y,\ ground\_elevation);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (success)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ successful\_updates++;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00151}00151\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00152}00152\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00153}00153\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00154}00154\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00155}00155\ \ \ \ \ \textcolor{comment}{//\ Verify\ map\ creation}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00156}00156\ \ \ \ \ EXPECT\_GT(successful\_updates,\ 0)\ <<\ \textcolor{stringliteral}{"{}No\ successful\ terrain\ map\ updates"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00157}00157\ \ \ \ \ EXPECT\_GT(terrain\_map\_-\/>getActiveAreasCount(),\ 0)\ <<\ \textcolor{stringliteral}{"{}No\ active\ areas\ in\ terrain\ map"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00158}00158\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00159}00159\ \ \ \ \ \textcolor{comment}{//\ Test\ elevation\ retrieval\ at\ known\ points}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00160}00160\ \ \ \ \ \textcolor{keywordflow}{if}\ (!odom\_messages\_.empty()\ \&\&\ !sonar\_messages\_.empty()\ \&\&\ successful\_updates\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00161}00161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ a\ position\ that\ was\ actually\ updated\ in\ the\ terrain\ map}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00162}00162\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\_valid\_elevation\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00163}00163\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00164}00164\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ std::min(\textcolor{keywordtype}{size\_t}(10),\ data\_points\_to\_process);\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!std::isnan(sonar\_messages\_[i]-\/>range)\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !std::isinf(sonar\_messages\_[i]-\/>range)\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sonar\_messages\_[i]-\/>range\ >\ 0.0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00168}00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ test\_x\ =\ odom\_messages\_[i]-\/>pose.pose.position.x;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ test\_y\ =\ odom\_messages\_[i]-\/>pose.pose.position.y;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ elevation\ =\ terrain\_map\_-\/>getElevationAtPoint(test\_x,\ test\_y);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ position\ has\ valid\ elevation\ data}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (elevation\ !=\ 0.0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ found\_valid\_elevation\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Found\ valid\ elevation\ \%.2fm\ at\ position\ (\%.2f,\ \%.2f)"{}},\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elevation,\ test\_x,\ test\_y);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00182}00182\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00183}00183\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00184}00184\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ should\ find\ at\ least\ one\ valid\ elevation\ if\ we\ had\ successful\ updates}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00185}00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (successful\_updates\ >\ 50)\ \{\ \ \textcolor{comment}{//\ Only\ expect\ valid\ elevations\ if\ we\ had\ many\ updates}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ EXPECT\_TRUE(found\_valid\_elevation)\ <<\ \textcolor{stringliteral}{"{}Should\ find\ at\ least\ one\ non-\/zero\ elevation\ with\ "{}}\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ successful\_updates\ <<\ \textcolor{stringliteral}{"{}\ successful\ updates"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00188}00188\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00189}00189\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00190}00190\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00191}00191\ \ \ \ \ \textcolor{comment}{//\ Test\ map\ boundaries}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00192}00192\ \ \ \ \ \textcolor{keyword}{auto}\ map\_center\ =\ terrain\_map\_-\/>getMapCentre();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00193}00193\ \ \ \ \ \textcolor{keyword}{auto}\ map\_size\ =\ terrain\_map\_-\/>getMapSize();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00194}00194\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00195}00195\ \ \ \ \ EXPECT\_GT(map\_size.x(),\ 0.0)\ <<\ \textcolor{stringliteral}{"{}Map\ should\ have\ positive\ X\ dimension"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00196}00196\ \ \ \ \ EXPECT\_GT(map\_size.y(),\ 0.0)\ <<\ \textcolor{stringliteral}{"{}Map\ should\ have\ positive\ Y\ dimension"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00198}00198\ \ \ \ \ EXPECT\_TRUE(std::isfinite(map\_center.x()))\ <<\ \textcolor{stringliteral}{"{}Map\ center\ X\ should\ be\ finite"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00199}00199\ \ \ \ \ EXPECT\_TRUE(std::isfinite(map\_center.y()))\ <<\ \textcolor{stringliteral}{"{}Map\ center\ Y\ should\ be\ finite"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00200}00200\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00201}00201\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00202}00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}GridMap\ test\ completed:\ \%d\ successful\ updates,\ map\ size:\ \%.1fx\%.1f"{}},}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ successful\_updates,\ map\_size.x(),\ map\_size.y());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00204}00204\ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00205}00205\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00212}\mbox{\hyperlink{drone__survey__tests_8cpp_a0004bffa7f1781c3ec8e7d139b7f7ba7}{00212}}\ \mbox{\hyperlink{drone__survey__tests_8cpp_a2df20e2d0d416ede74f0ffa700e98ba9}{TEST\_F}}(\mbox{\hyperlink{class_drone_unit_test}{DroneUnitTest}},\ TestGoalTraversability)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00213}00213\ \ \ \ \ \textcolor{comment}{//\ Load\ test\ data}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00214}00214\ \ \ \ \ std::string\ bag\_path\ =\ \textcolor{stringliteral}{"{}/home/wooboontoo/ros2\_ws/src/a3\_skeleton/test\_data/drone\_survey\_traversability\_test"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00215}00215\ \ \ \ \ ASSERT\_TRUE(loadROSbagData(bag\_path))\ <<\ \textcolor{stringliteral}{"{}Failed\ to\ load\ test\ ROSbag\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00216}00216\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00217}00217\ \ \ \ \ ASSERT\_FALSE(goals\_messages\_.empty())\ <<\ \textcolor{stringliteral}{"{}No\ goal\ messages\ in\ test\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00218}00218\ \ \ \ \ ASSERT\_FALSE(odom\_messages\_.empty())\ <<\ \textcolor{stringliteral}{"{}No\ odometry\ messages\ in\ test\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00219}00219\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00220}00220\ \ \ \ \ \textcolor{comment}{//\ Build\ terrain\ map\ from\ recorded\ data\ first}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00221}00221\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ data\_points\ =\ std::min(odom\_messages\_.size(),\ sonar\_messages\_.size());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00222}00222\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ data\_points;\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00223}00223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!std::isnan(sonar\_messages\_[i]-\/>range)\ \&\&\ sonar\_messages\_[i]-\/>range\ >\ 0.0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_x\ =\ odom\_messages\_[i]-\/>pose.pose.position.x;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_y\ =\ odom\_messages\_[i]-\/>pose.pose.position.y;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_z\ =\ odom\_messages\_[i]-\/>pose.pose.position.z;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ground\_elevation\ =\ drone\_z\ -\/\ sonar\_messages\_[i]-\/>range;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ terrain\_map\_-\/>updateElevation(drone\_x,\ drone\_y,\ ground\_elevation);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ gradients\ around\ this\ point}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ terrain\_map\_-\/>calculateGradientsAroundPoint(drone\_x,\ drone\_y,\ 2.0);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00233}00233\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00234}00234\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00235}00235\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00236}00236\ \ \ \ \ \textcolor{comment}{//\ Test\ traversability\ for\ recorded\ goals}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00237}00237\ \ \ \ \ \textcolor{keyword}{auto}\ goals\ =\ goals\_messages\_[0]-\/>poses;\ \ \textcolor{comment}{//\ Use\ first\ goal\ message}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00238}00238\ \ \ \ \ geometry\_msgs::msg::Point\ current\_pos\ =\ odom\_messages\_[0]-\/>pose.pose.position;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00239}00239\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00240}00240\ \ \ \ \ \textcolor{comment}{//\ Create\ waypoint\ manager\ for\ testing}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00241}00241\ \ \ \ \ \textcolor{keyword}{auto}\ waypoints\_pub\ =\ node\_-\/>create\_publisher<geometry\_msgs::msg::PoseArray>(\textcolor{stringliteral}{"{}/test/waypoints"{}},\ 10);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00242}00242\ \ \ \ \ \textcolor{keyword}{auto}\ markers\_pub\ =\ node\_-\/>create\_publisher<visualization\_msgs::msg::MarkerArray>(\textcolor{stringliteral}{"{}/test/markers"{}},\ 10);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00243}00243\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00244}00244\ \ \ \ \ \mbox{\hyperlink{class_waypoint_manager}{WaypointManager}}\ waypoint\_manager(node\_-\/>get\_logger(),\ 3.0,\ waypoints\_pub,\ markers\_pub);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00245}00245\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00246}00246\ \ \ \ \ \textcolor{comment}{//\ Set\ elevation\ function}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00247}00247\ \ \ \ \ waypoint\_manager.setElevationFunction([\textcolor{keyword}{this}](\textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ point)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00248}00248\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ terrain\_map\_-\/>getElevationAtPoint(point.x,\ point.y);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00249}00249\ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00250}00250\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00251}00251\ \ \ \ \ \textcolor{comment}{//\ Set\ gradient\ function}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00252}00252\ \ \ \ \ waypoint\_manager.setGradientFunction([\textcolor{keyword}{this}](\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00253}00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ terrain\_map\_-\/>getGradientMagnitudeAtPoint(x,\ y);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00254}00254\ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00255}00255\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00256}00256\ \ \ \ \ \textcolor{keywordtype}{int}\ traversable\_goals\ =\ 0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00257}00257\ \ \ \ \ \textcolor{keywordtype}{int}\ non\_traversable\_goals\ =\ 0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00258}00258\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00259}00259\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ goal\ :\ goals)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00260}00260\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ individual\ goal\ traversability}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00261}00261\ \ \ \ \ \ \ \ \ geometry\_msgs::msg::Pose\ start\_pose;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00262}00262\ \ \ \ \ \ \ \ \ start\_pose.position\ =\ current\_pos;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00263}00263\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00264}00264\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_traversable\ =\ waypoint\_manager.isTraversable(start\_pose,\ goal);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00265}00265\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00266}00266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_traversable)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ traversable\_goals++;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ non\_traversable\_goals++;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00270}00270\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00271}00271\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00272}00272\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ gradient\ at\ goal\ position}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00273}00273\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ gradient\ =\ terrain\_map\_-\/>getGradientMagnitudeAtPoint(goal.position.x,\ goal.position.y);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00274}00274\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ gradient\_percent\ =\ gradient\ *\ 100.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00275}00275\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00276}00276\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Goal\ at\ (\%.1f,\ \%.1f):\ gradient=\%.1f\%\%,\ traversable=\%s"{}},}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00278}00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ goal.position.x,\ goal.position.y,\ gradient\_percent,\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00279}00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_traversable\ ?\ \textcolor{stringliteral}{"{}YES"{}}\ :\ \textcolor{stringliteral}{"{}NO"{}});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00280}00280\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00281}00281\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ current\ position\ for\ next\ test}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00282}00282\ \ \ \ \ \ \ \ \ current\_pos\ =\ goal.position;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00283}00283\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00284}00284\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00285}00285\ \ \ \ \ \textcolor{comment}{//\ Verify\ we\ tested\ goals\ and\ got\ reasonable\ results}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00286}00286\ \ \ \ \ EXPECT\_GT(traversable\_goals\ +\ non\_traversable\_goals,\ 0)\ <<\ \textcolor{stringliteral}{"{}No\ goals\ were\ tested"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00287}00287\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00288}00288\ \ \ \ \ \textcolor{comment}{//\ The\ system\ should\ find\ SOME\ goals\ traversable\ and\ SOME\ non-\/traversable\ in\ realistic\ terrain}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00289}00289\ \ \ \ \ \textcolor{comment}{//\ This\ shows\ the\ gradient\ detection\ is\ working}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00290}00290\ \ \ \ \ EXPECT\_TRUE(traversable\_goals\ >\ 0\ ||\ non\_traversable\_goals\ >\ 0)\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00291}00291\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}System\ should\ classify\ goals\ as\ either\ traversable\ or\ non-\/traversable"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00292}00292\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00293}00293\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00294}00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Traversability\ test\ completed:\ \%d\ traversable,\ \%d\ non-\/traversable\ goals"{}},}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00295}00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversable\_goals,\ non\_traversable\_goals);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00296}00296\ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00297}00297\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00298}00298\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00306}\mbox{\hyperlink{drone__survey__tests_8cpp_a4b30b62d977ba9b4bbb27f0d1a56102f}{00306}}\ \mbox{\hyperlink{drone__survey__tests_8cpp_a2df20e2d0d416ede74f0ffa700e98ba9}{TEST\_F}}(\mbox{\hyperlink{class_drone_unit_test}{DroneUnitTest}},\ TestTSPSolver)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00307}00307\ \ \ \ \ \textcolor{comment}{//\ Load\ TSP\ test\ data\ (contains\ mapping\ of\ all\ 5\ goals\ +\ complete\ terrain\ data)}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00308}00308\ \ \ \ \ std::string\ bag\_path\ =\ \textcolor{stringliteral}{"{}/home/wooboontoo/ros2\_ws/src/a3\_skeleton/test\_data/drone\_survey\_tsp\_test"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00309}00309\ \ \ \ \ ASSERT\_TRUE(loadROSbagData(bag\_path))\ <<\ \textcolor{stringliteral}{"{}Failed\ to\ load\ test\ ROSbag\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00310}00310\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00311}00311\ \ \ \ \ ASSERT\_FALSE(goals\_messages\_.empty())\ <<\ \textcolor{stringliteral}{"{}No\ goal\ messages\ in\ test\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00312}00312\ \ \ \ \ ASSERT\_FALSE(odom\_messages\_.empty())\ <<\ \textcolor{stringliteral}{"{}No\ odometry\ messages\ in\ test\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00313}00313\ \ \ \ \ ASSERT\_FALSE(sonar\_messages\_.empty())\ <<\ \textcolor{stringliteral}{"{}No\ sonar\ messages\ in\ test\ data"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00314}00314\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00315}00315\ \ \ \ \ \textcolor{comment}{//\ Build\ terrain\ map\ from\ complete\ flight\ data}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00316}00316\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ data\_points\ =\ std::min(odom\_messages\_.size(),\ sonar\_messages\_.size());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00317}00317\ \ \ \ \ \textcolor{keywordtype}{int}\ successful\_updates\ =\ 0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00318}00318\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00319}00319\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Building\ terrain\ map\ from\ \%zu\ data\ points"{}},\ data\_points);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00320}00320\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00321}00321\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ data\_points;\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00322}00322\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!std::isnan(sonar\_messages\_[i]-\/>range)\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ !std::isinf(sonar\_messages\_[i]-\/>range)\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00324}00324\ \ \ \ \ \ \ \ \ \ \ \ \ sonar\_messages\_[i]-\/>range\ >\ 0.0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00326}00326\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_x\ =\ odom\_messages\_[i]-\/>pose.pose.position.x;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_y\ =\ odom\_messages\_[i]-\/>pose.pose.position.y;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00328}00328\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ drone\_z\ =\ odom\_messages\_[i]-\/>pose.pose.position.z;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ground\_elevation\ =\ drone\_z\ -\/\ sonar\_messages\_[i]-\/>range;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (terrain\_map\_-\/>updateElevation(drone\_x,\ drone\_y,\ ground\_elevation))\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ successful\_updates++;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ gradients\ for\ traversability\ analysis}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ terrain\_map\_-\/>calculateGradientsAroundPoint(drone\_x,\ drone\_y,\ 2.0);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00335}00335\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00336}00336\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00337}00337\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00338}00338\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00339}00339\ \ \ \ \ ASSERT\_GT(successful\_updates,\ 20)\ <<\ \textcolor{stringliteral}{"{}Insufficient\ terrain\ data\ for\ TSP\ testing"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00340}00340\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Built\ terrain\ map\ with\ \%d\ successful\ updates"{}},\ successful\_updates);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00341}00341\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00342}00342\ \ \ \ \ \textcolor{comment}{//\ Get\ goals\ from\ recorded\ data}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00343}00343\ \ \ \ \ \textcolor{keyword}{auto}\ goals\ =\ goals\_messages\_[0]-\/>poses;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00344}00344\ \ \ \ \ ASSERT\_GE(goals.size(),\ 3)\ <<\ \textcolor{stringliteral}{"{}Need\ at\ least\ 3\ goals\ for\ meaningful\ TSP\ test"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00345}00345\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00346}00346\ \ \ \ \ \textcolor{comment}{//\ Define\ start\ position\ from\ actual\ flight\ data}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00347}00347\ \ \ \ \ geometry\_msgs::msg::Point\ start\_position;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00348}00348\ \ \ \ \ start\_position\ =\ odom\_messages\_[0]-\/>pose.pose.position;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00349}00349\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00350}00350\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Starting\ from\ (\%.2f,\ \%.2f,\ \%.2f)"{}},\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ start\_position.x,\ start\_position.y,\ start\_position.z);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00352}00352\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00353}00353\ \ \ \ \ \textcolor{comment}{//\ STEP\ 1:\ Construct\ traversability\ graph\ between\ all\ goal\ nodes}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00354}00354\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Constructing\ traversability\ graph\ for\ \%zu\ goals..."{}},\ goals.size());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00355}00355\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00356}00356\ \ \ \ \ \textcolor{comment}{//\ Graph\ representation:\ adjacency\ matrix}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00357}00357\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_goals\ =\ goals.size();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00358}00358\ \ \ \ \ std::vector<std::vector<double>>\ traversability\_graph(num\_goals,\ std::vector<double>(num\_goals,\ -\/1.0));}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00359}00359\ \ \ \ \ std::vector<std::vector<bool>>\ traversable\_matrix(num\_goals,\ std::vector<bool>(num\_goals,\ \textcolor{keyword}{false}));}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00360}00360\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00361}00361\ \ \ \ \ \textcolor{comment}{//\ Define\ cost\ function\ (3D\ Euclidean\ distance)}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00362}00362\ \ \ \ \ \textcolor{keyword}{auto}\ cost\_function\ =\ [](\textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ from,\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00363}00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ to)\ -\/>\ \textcolor{keywordtype}{double}\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00364}00364\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dx\ =\ to.x\ -\/\ from.x;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00365}00365\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dy\ =\ to.y\ -\/\ from.y;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00366}00366\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dz\ =\ to.z\ -\/\ from.z;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00367}00367\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::sqrt(dx*dx\ +\ dy*dy\ +\ dz*dz);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00368}00368\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00369}00369\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00370}00370\ \ \ \ \ \textcolor{comment}{//\ Define\ traversability\ function\ (drone-\/appropriate)}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00371}00371\ \ \ \ \ \textcolor{keyword}{auto}\ traversability\_function\ =\ [](\textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ from,}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ to)\ -\/>\ \textcolor{keywordtype}{bool}\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00373}00373\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ drone\ operations,\ check\ basic\ bounds\ and\ reasonable\ altitude\ changes}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00374}00374\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(from.x)\ >\ 20.0\ ||\ std::abs(from.y)\ >\ 20.0\ ||\ from.z\ <\ 0\ ||\ from.z\ >\ 20.0\ ||}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00375}00375\ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(to.x)\ >\ 20.0\ ||\ std::abs(to.y)\ >\ 20.0\ ||\ to.z\ <\ 0\ ||\ to.z\ >\ 20.0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00377}00377\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00378}00378\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00379}00379\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ for\ reasonable\ altitude\ changes}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00380}00380\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ altitude\_diff\ =\ std::abs(to.z\ -\/\ from.z);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00381}00381\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ horizontal\_distance\ =\ std::sqrt(std::pow(to.x\ -\/\ from.x,\ 2)\ +\ std::pow(to.y\ -\/\ from.y,\ 2));}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00382}00382\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00383}00383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (horizontal\_distance\ >\ 0.1)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ climb\_angle\ =\ std::atan(altitude\_diff\ /\ horizontal\_distance)\ *\ 180.0\ /\ M\_PI;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (climb\_angle\ >\ 60.0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00386}00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00387}00387\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00388}00388\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00389}00389\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00390}00390\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00391}00391\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00392}00392\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00393}00393\ \ \ \ \ \textcolor{comment}{//\ Build\ traversability\ graph\ between\ all\ pairs\ of\ goals}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00394}00394\ \ \ \ \ \textcolor{keywordtype}{int}\ traversable\_edges\ =\ 0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00395}00395\ \ \ \ \ \textcolor{keywordtype}{int}\ total\_edges\ =\ 0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00396}00396\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00397}00397\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_goals;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00398}00398\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ num\_goals;\ j++)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00399}00399\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ j)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Self-\/connection}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00401}00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversability\_graph[i][j]\ =\ 0.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00402}00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversable\_matrix[i][j]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00403}00403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00404}00404\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00405}00405\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ total\_edges++;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ path\ from\ goal\ i\ to\ goal\ j\ is\ traversable}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_traversable\ =\ traversability\_function(goals[i].position,\ goals[j].position);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00410}00410\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00411}00411\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_traversable)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ cost\ =\ cost\_function(goals[i].position,\ goals[j].position);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversability\_graph[i][j]\ =\ cost;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversable\_matrix[i][j]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversable\_edges++;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00417}00417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_DEBUG(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Edge\ \%zu-\/>\%zu:\ traversable,\ cost=\%.2fm"{}},\ i,\ j,\ cost);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00418}00418\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00419}00419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversability\_graph[i][j]\ =\ -\/1.0;\ \textcolor{comment}{//\ Mark\ as\ untraversable}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversable\_matrix[i][j]\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00421}00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00422}00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_DEBUG(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Edge\ \%zu-\/>\%zu:\ NOT\ traversable"{}},\ i,\ j);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00424}00424\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00425}00425\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00426}00426\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00427}00427\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Graph\ constructed\ -\/\ \%d/\%d\ edges\ are\ traversable\ (\%.1f\%\%)"{}},\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traversable\_edges,\ total\_edges,\ (traversable\_edges\ *\ 100.0)\ /\ total\_edges);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00429}00429\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00430}00430\ \ \ \ \ \textcolor{comment}{//\ Verify\ graph\ connectivity}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00431}00431\ \ \ \ \ EXPECT\_GT(traversable\_edges,\ 0)\ <<\ \textcolor{stringliteral}{"{}Graph\ should\ have\ some\ traversable\ edges"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00432}00432\ \ \ \ \ EXPECT\_GT(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(traversable\_edges)\ /\ total\_edges,\ 0.5)\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00433}00433\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Most\ edges\ should\ be\ traversable\ for\ drone\ operations"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00434}00434\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00435}00435\ \ \ \ \ \textcolor{comment}{//\ STEP\ 2:\ Store\ the\ graph\ without\ start/end\ nodes\ (as\ required)}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00436}00436\ \ \ \ \ \textcolor{comment}{//\ The\ graph\ is\ stored\ in\ traversability\_graph\ and\ can\ be\ reused}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00437}00437\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Graph\ stored\ for\ reuse\ (without\ start/end\ nodes)"{}});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00438}00438\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00439}00439\ \ \ \ \ \textcolor{comment}{//\ STEP\ 3:\ Use\ TSP\ to\ find\ shortest\ path\ visiting\ all\ nodes\ once}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00440}00440\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Finding\ shortest\ path\ through\ all\ \%zu\ nodes..."{}},\ num\_goals);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00441}00441\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00442}00442\ \ \ \ \ \textcolor{comment}{//\ Modified\ cost\ function\ that\ uses\ the\ pre-\/computed\ graph}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00443}00443\ \ \ \ \ \textcolor{keyword}{auto}\ graph\_cost\_function\ =\ [\&traversability\_graph,\ \&goals](\textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ from,\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ to)\ -\/>\ \textcolor{keywordtype}{double}\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00445}00445\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ which\ goal\ indices\ correspond\ to\ from\ and\ to\ positions}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00446}00446\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ from\_idx\ =\ SIZE\_MAX,\ to\_idx\ =\ SIZE\_MAX;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00447}00447\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00448}00448\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ goals.size();\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00449}00449\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(goals[i].position.x\ -\/\ from.x)\ <\ 0.1\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00450}00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.y\ -\/\ from.y)\ <\ 0.1\ \&\&}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00451}00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.z\ -\/\ from.z)\ <\ 0.1)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00452}00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_idx\ =\ i;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00453}00453\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00454}00454\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(goals[i].position.x\ -\/\ to.x)\ <\ 0.1\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00455}00455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.y\ -\/\ to.y)\ <\ 0.1\ \&\&}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00456}00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.z\ -\/\ to.z)\ <\ 0.1)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00457}00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_idx\ =\ i;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00458}00458\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00459}00459\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00460}00460\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00461}00461\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ both\ positions\ are\ in\ the\ graph,\ use\ graph\ cost}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00462}00462\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_idx\ !=\ SIZE\_MAX\ \&\&\ to\_idx\ !=\ SIZE\_MAX\ \&\&\ traversability\_graph[from\_idx][to\_idx]\ >=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00463}00463\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ traversability\_graph[from\_idx][to\_idx];}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00464}00464\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00465}00465\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00466}00466\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ calculate\ direct\ distance\ (for\ start\ position\ to\ first\ goal)}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00467}00467\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dx\ =\ to.x\ -\/\ from.x;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00468}00468\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dy\ =\ to.y\ -\/\ from.y;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00469}00469\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dz\ =\ to.z\ -\/\ from.z;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00470}00470\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::sqrt(dx*dx\ +\ dy*dy\ +\ dz*dz);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00471}00471\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00472}00472\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00473}00473\ \ \ \ \ \textcolor{comment}{//\ Modified\ traversability\ function\ that\ uses\ the\ pre-\/computed\ graph}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00474}00474\ \ \ \ \ \textcolor{keyword}{auto}\ graph\_traversability\_function\ =\ [\&traversable\_matrix,\ \&goals](\textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ from,}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00475}00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ geometry\_msgs::msg::Point\&\ to)\ -\/>\ \textcolor{keywordtype}{bool}\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00476}00476\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ which\ goal\ indices\ correspond\ to\ from\ and\ to\ positions}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00477}00477\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ from\_idx\ =\ SIZE\_MAX,\ to\_idx\ =\ SIZE\_MAX;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00478}00478\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00479}00479\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ goals.size();\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00480}00480\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(goals[i].position.x\ -\/\ from.x)\ <\ 0.1\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00481}00481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.y\ -\/\ from.y)\ <\ 0.1\ \&\&}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00482}00482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.z\ -\/\ from.z)\ <\ 0.1)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00483}00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_idx\ =\ i;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00484}00484\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00485}00485\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::abs(goals[i].position.x\ -\/\ to.x)\ <\ 0.1\ \&\&\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00486}00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.y\ -\/\ to.y)\ <\ 0.1\ \&\&}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00487}00487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::abs(goals[i].position.z\ -\/\ to.z)\ <\ 0.1)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00488}00488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_idx\ =\ i;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00489}00489\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00490}00490\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00491}00491\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00492}00492\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ both\ positions\ are\ in\ the\ graph,\ use\ graph\ traversability}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00493}00493\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_idx\ !=\ SIZE\_MAX\ \&\&\ to\_idx\ !=\ SIZE\_MAX)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00494}00494\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ traversable\_matrix[from\_idx][to\_idx];}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00495}00495\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00496}00496\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00497}00497\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ assume\ traversable\ (for\ start\ position)}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00498}00498\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00499}00499\ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00500}00500\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00501}00501\ \ \ \ \ \textcolor{comment}{//\ Calculate\ baseline\ cost\ (sequential\ order\ through\ graph)}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00502}00502\ \ \ \ \ \textcolor{keywordtype}{double}\ baseline\_cost\ =\ graph\_cost\_function(start\_position,\ goals[0].position);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00503}00503\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ goals.size()\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00504}00504\ \ \ \ \ \ \ \ \ baseline\_cost\ +=\ graph\_cost\_function(goals[i].position,\ goals[i+1].position);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00505}00505\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00506}00506\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00507}00507\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Baseline\ sequential\ cost\ through\ graph:\ \%.2fm"{}},\ baseline\_cost);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00508}00508\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00509}00509\ \ \ \ \ \textcolor{comment}{//\ Solve\ TSP\ using\ the\ graph-\/based\ functions}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00510}00510\ \ \ \ \ \textcolor{keyword}{auto}\ solution\ =\ tsp\_solver\_-\/>solveTSP(goals,\ start\_position,\ graph\_cost\_function,\ graph\_traversability\_function);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00511}00511\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00512}00512\ \ \ \ \ \textcolor{comment}{//\ STEP\ 4:\ Verify\ TSP\ solution}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00513}00513\ \ \ \ \ EXPECT\_TRUE(solution.solution\_found)\ <<\ \textcolor{stringliteral}{"{}TSP\ solver\ should\ find\ a\ solution\ using\ the\ traversability\ graph"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00514}00514\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00515}00515\ \ \ \ \ \textcolor{keywordflow}{if}\ (!solution.solution\_found)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00516}00516\ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ No\ solution\ found\ using\ traversability\ graph"{}});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00517}00517\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00518}00518\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00519}00519\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00520}00520\ \ \ \ \ EXPECT\_EQ(solution.path.size(),\ goals.size())\ <<\ \textcolor{stringliteral}{"{}Solution\ should\ visit\ all\ nodes\ once"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00521}00521\ \ \ \ \ EXPECT\_GT(solution.total\_cost,\ 0.0)\ <<\ \textcolor{stringliteral}{"{}Total\ cost\ should\ be\ positive"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00522}00522\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00523}00523\ \ \ \ \ \textcolor{comment}{//\ Verify\ all\ goals\ are\ included\ exactly\ once}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00524}00524\ \ \ \ \ std::set<size\_t>\ goal\_indices;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00525}00525\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ goals.size();\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00526}00526\ \ \ \ \ \ \ \ \ goal\_indices.insert(i);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00527}00527\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00528}00528\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00529}00529\ \ \ \ \ std::set<size\_t>\ solution\_indices(solution.path.begin(),\ solution.path.end());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00530}00530\ \ \ \ \ EXPECT\_EQ(goal\_indices,\ solution\_indices)\ <<\ \textcolor{stringliteral}{"{}Solution\ should\ include\ all\ goal\ indices\ exactly\ once"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00531}00531\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00532}00532\ \ \ \ \ \textcolor{comment}{//\ TSP\ should\ provide\ optimization\ benefit\ using\ the\ graph}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00533}00533\ \ \ \ \ EXPECT\_LE(solution.total\_cost,\ baseline\_cost\ *\ 1.1)\ <<\ \textcolor{stringliteral}{"{}TSP\ should\ find\ near-\/optimal\ path\ using\ graph"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00534}00534\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00535}00535\ \ \ \ \ \textcolor{comment}{//\ Verify\ we\ found\ multiple\ valid\ paths\ in\ the\ graph}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00536}00536\ \ \ \ \ EXPECT\_GT(solution.all\_valid\_paths.size(),\ 0)\ <<\ \textcolor{stringliteral}{"{}Should\ find\ valid\ paths\ using\ traversability\ graph"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00537}00537\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00538}00538\ \ \ \ \ \textcolor{comment}{//\ Performance\ check}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00539}00539\ \ \ \ \ EXPECT\_LT(solution.solve\_time.count(),\ 15000)\ <<\ \textcolor{stringliteral}{"{}TSP\ should\ solve\ within\ 15\ seconds\ using\ pre-\/computed\ graph"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00540}00540\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00541}00541\ \ \ \ \ \textcolor{comment}{//\ STEP\ 5:\ Test\ graph\ reuse\ capability}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00542}00542\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP:\ Testing\ graph\ reuse..."{}});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00543}00543\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00544}00544\ \ \ \ \ \textcolor{comment}{//\ Modify\ start\ position\ and\ solve\ again\ using\ the\ same\ stored\ graph}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00545}00545\ \ \ \ \ geometry\_msgs::msg::Point\ alternate\_start\ =\ start\_position;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00546}00546\ \ \ \ \ alternate\_start.x\ +=\ 1.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00547}00547\ \ \ \ \ alternate\_start.y\ +=\ 1.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00548}00548\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00549}00549\ \ \ \ \ \textcolor{keyword}{auto}\ reuse\_solution\ =\ tsp\_solver\_-\/>solveTSP(goals,\ alternate\_start,\ graph\_cost\_function,\ graph\_traversability\_function);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00550}00550\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00551}00551\ \ \ \ \ EXPECT\_TRUE(reuse\_solution.solution\_found)\ <<\ \textcolor{stringliteral}{"{}Should\ be\ able\ to\ reuse\ stored\ graph\ with\ different\ start\ position"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00552}00552\ \ \ \ \ EXPECT\_EQ(reuse\_solution.path.size(),\ goals.size())\ <<\ \textcolor{stringliteral}{"{}Reuse\ solution\ should\ visit\ all\ nodes"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00553}00553\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00554}00554\ \ \ \ \ \textcolor{comment}{//\ Calculate\ optimization\ benefit}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00555}00555\ \ \ \ \ \textcolor{keywordflow}{if}\ (solution.all\_valid\_paths.size()\ >\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00556}00556\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ worst\_cost\ =\ *std::max\_element(solution.path\_costs.begin(),\ solution.path\_costs.end());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00557}00557\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ optimization\_benefit\ =\ ((worst\_cost\ -\/\ solution.total\_cost)\ /\ worst\_cost)\ *\ 100.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00558}00558\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00559}00559\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00560}00560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}TSP\ optimization\ using\ graph:\ saved\ \%.1f\%\%\ (\%.2fm)\ vs\ worst\ valid\ path"{}},\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00561}00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ optimization\_benefit,\ worst\_cost\ -\/\ solution.total\_cost);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00562}00562\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00563}00563\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00564}00564\ \ \ \ \ \textcolor{comment}{//\ Log\ detailed\ results}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00565}00565\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}TSP\ graph-\/based\ test\ completed\ successfully:"{}});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00566}00566\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}\ \ -\/\ Constructed\ graph:\ \%zu\ nodes,\ \%d/\%d\ traversable\ edges\ (\%.1f\%\%)"{}},\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00567}00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ num\_goals,\ traversable\_edges,\ total\_edges,\ (traversable\_edges\ *\ 100.0)\ /\ total\_edges);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00568}00568\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}\ \ -\/\ Optimal\ path\ cost:\ \%.2fm\ (baseline:\ \%.2fm)"{}},\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00569}00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solution.total\_cost,\ baseline\_cost);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00570}00570\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}\ \ -\/\ Valid\ paths\ found:\ \%zu,\ Solve\ time:\ \%ld\ ms"{}},\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00571}00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solution.all\_valid\_paths.size(),\ solution.solve\_time.count());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00572}00572\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}\ \ -\/\ Graph\ successfully\ reused\ with\ alternate\ start\ position"{}});}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00573}00573\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00574}00574\ \ \ \ \ \textcolor{comment}{//\ Log\ optimal\ path\ through\ the\ graph}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00575}00575\ \ \ \ \ std::string\ path\_str\ =\ \textcolor{stringliteral}{"{}TSP:\ Optimal\ path\ through\ graph:\ START"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00576}00576\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ idx\ :\ solution.path)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00577}00577\ \ \ \ \ \ \ \ \ path\_str\ +=\ \textcolor{stringliteral}{"{}\ -\/>\ NODE"{}}\ +\ std::to\_string(idx);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00578}00578\ \ \ \ \ \ \ \ \ path\_str\ +=\ \textcolor{stringliteral}{"{}("{}}\ +\ std::to\_string(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(goals[idx].position.x))\ +\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00579}00579\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},"{}}\ +\ std::to\_string(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(goals[idx].position.y))\ +\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00580}00580\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00581}00581\ \ \ \ \ RCLCPP\_INFO(node\_-\/>get\_logger(),\ \textcolor{stringliteral}{"{}\%s"{}},\ path\_str.c\_str());}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00582}00582\ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00583}00583\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00584}00584\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00588}\mbox{\hyperlink{drone__survey__tests_8cpp_a7f878ef3a98f55a99fac339e5866fa7f}{00588}}\ \mbox{\hyperlink{drone__survey__tests_8cpp_a2df20e2d0d416ede74f0ffa700e98ba9}{TEST\_F}}(\mbox{\hyperlink{class_drone_unit_test}{DroneUnitTest}},\ TestBoundaryConditions)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00589}00589\ \ \ \ \ \textcolor{comment}{//\ Test\ empty\ goal\ set}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00590}00590\ \ \ \ \ std::vector<geometry\_msgs::msg::Pose>\ empty\_goals;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00591}00591\ \ \ \ \ geometry\_msgs::msg::Point\ start\_pos;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00592}00592\ \ \ \ \ start\_pos.x\ =\ start\_pos.y\ =\ start\_pos.z\ =\ 0.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00593}00593\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00594}00594\ \ \ \ \ \textcolor{keyword}{auto}\ dummy\_cost\ =\ [](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&,\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&)\ \{\ \textcolor{keywordflow}{return}\ 1.0;\ \};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00595}00595\ \ \ \ \ \textcolor{keyword}{auto}\ dummy\_traversability\ =\ [](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&,\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&)\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00596}00596\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00597}00597\ \ \ \ \ \textcolor{keyword}{auto}\ empty\_solution\ =\ tsp\_solver\_-\/>solveTSP(empty\_goals,\ start\_pos,\ dummy\_cost,\ dummy\_traversability);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00598}00598\ \ \ \ \ EXPECT\_FALSE(empty\_solution.solution\_found)\ <<\ \textcolor{stringliteral}{"{}Empty\ goal\ set\ should\ not\ have\ solution"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00599}00599\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00600}00600\ \ \ \ \ \textcolor{comment}{//\ Test\ single\ goal}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00601}00601\ \ \ \ \ std::vector<geometry\_msgs::msg::Pose>\ single\_goal(1);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00602}00602\ \ \ \ \ single\_goal[0].position.x\ =\ 1.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00603}00603\ \ \ \ \ single\_goal[0].position.y\ =\ 1.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00604}00604\ \ \ \ \ single\_goal[0].position.z\ =\ 2.0;}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00605}00605\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00606}00606\ \ \ \ \ \textcolor{keyword}{auto}\ single\_solution\ =\ tsp\_solver\_-\/>solveTSP(single\_goal,\ start\_pos,\ dummy\_cost,\ dummy\_traversability);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00607}00607\ \ \ \ \ EXPECT\_TRUE(single\_solution.solution\_found)\ <<\ \textcolor{stringliteral}{"{}Single\ goal\ should\ have\ solution"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00608}00608\ \ \ \ \ EXPECT\_EQ(single\_solution.path.size(),\ 1)\ <<\ \textcolor{stringliteral}{"{}Single\ goal\ path\ should\ have\ one\ element"{}};}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00609}00609\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00610}00610\ \ \ \ \ \textcolor{comment}{//\ Test\ invalid\ sonar\ readings}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00611}00611\ \ \ \ \ EXPECT\_FALSE(terrain\_map\_-\/>updateElevation(0.0,\ 0.0,\ std::numeric\_limits<double>::infinity()));}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00612}00612\ \ \ \ \ EXPECT\_FALSE(terrain\_map\_-\/>updateElevation(0.0,\ 0.0,\ std::numeric\_limits<double>::quiet\_NaN()));}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00613}00613\ \ \ \ \ EXPECT\_FALSE(terrain\_map\_-\/>updateElevation(0.0,\ 0.0,\ -\/1000.0));\ \ \textcolor{comment}{//\ Below\ reasonable\ bounds}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00614}00614\ \}}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00615}00615\ }
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00616}\mbox{\hyperlink{drone__survey__tests_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{00616}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{drone__survey__tests_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main}}(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}**\ argv)\ \{}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00617}00617\ \ \ \ \ ::testing::InitGoogleTest(\&argc,\ argv);}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00618}00618\ \ \ \ \ \textcolor{keywordflow}{return}\ RUN\_ALL\_TESTS();}
\DoxyCodeLine{\Hypertarget{drone__survey__tests_8cpp_source_l00619}00619\ \}}

\end{DoxyCode}
