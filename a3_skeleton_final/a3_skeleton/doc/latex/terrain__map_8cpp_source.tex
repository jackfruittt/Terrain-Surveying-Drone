\doxysection{terrain\+\_\+map.\+cpp}
\hypertarget{terrain__map_8cpp_source}{}\label{terrain__map_8cpp_source}\index{src/terrain\_map.cpp@{src/terrain\_map.cpp}}
\mbox{\hyperlink{terrain__map_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{terrain__map_8h}{terrain\_map.h}}"{}}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00005}\mbox{\hyperlink{class_terrain_map_a2dd1d760f543118ec2bd98105348dd75}{00005}}\ \mbox{\hyperlink{class_terrain_map_a2dd1d760f543118ec2bd98105348dd75}{TerrainMap::TerrainMap}}(\textcolor{keyword}{const}\ rclcpp::Logger\&\ logger,\ \textcolor{keywordtype}{double}\ resolution,\ \textcolor{keywordtype}{double}\ \textcolor{comment}{/*\ initial\_size\ */})}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00006}00006\ \ \ \ \ :\ logger\_(logger),}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00007}00007\ \ \ \ \ \ \ map\_resolution\_(resolution),}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00008}00008\ \ \ \ \ \ \ cell\_size\_(resolution),}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00009}00009\ \ \ \ \ \ \ initial\_x\_(0.0),}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00010}00010\ \ \ \ \ \ \ initial\_y\_(0.0),}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00011}00011\ \ \ \ \ \ \ map\_initialised\_(false)}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00012}00012\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00013}00013\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Initialising\ TerrainMap\ for\ 1x1m\ incremental\ expansion\ (resolution=\%.1fm)"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00014}00014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ resolution);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00015}00015\ \ \ \ \ \textcolor{comment}{//\ Map\ will\ be\ initialised\ when\ first\ drone\ position\ is\ received}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00016}00016\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00018}00018\ \textcolor{keywordtype}{void}\ TerrainMap::initialiseMap(\textcolor{keywordtype}{double}\ start\_x,\ \textcolor{keywordtype}{double}\ start\_y)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00019}00019\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00020}00020\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00021}00021\ \ \ \ \ \textcolor{keywordflow}{if}\ (map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00022}00022\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ Already\ initialised}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00023}00023\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00024}00024\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00025}00025\ \ \ \ \ \textcolor{comment}{//\ Store\ initial\ position}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00026}00026\ \ \ \ \ initial\_x\_\ =\ start\_x;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00027}00027\ \ \ \ \ initial\_y\_\ =\ start\_y;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00028}00028\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00029}00029\ \ \ \ \ \textcolor{comment}{//\ Create\ initial\ grid\ centred\ on\ drone's\ starting\ position}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00030}00030\ \ \ \ \ \textcolor{comment}{//\ Start\ with\ 1m\ x\ 1m\ physical\ size\ regardless\ of\ resolution}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00031}00031\ \ \ \ \ \textcolor{keywordtype}{double}\ initial\_physical\_size\ =\ 1.0;\ \ \textcolor{comment}{//\ Always\ 1m\ x\ 1m}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00032}00032\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00033}00033\ \ \ \ \ grid\_map\_.setFrameId(\textcolor{stringliteral}{"{}world"{}});}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00034}00034\ \ \ \ \ grid\_map\_.setGeometry(grid\_map::Length(initial\_physical\_size,\ initial\_physical\_size),\ map\_resolution\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00035}00035\ \ \ \ \ grid\_map\_.setPosition(grid\_map::Position(start\_x,\ start\_y));}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00036}00036\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00037}00037\ \ \ \ \ \textcolor{comment}{//\ Add\ required\ layers}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00038}00038\ \ \ \ \ grid\_map\_.add(\textcolor{stringliteral}{"{}elevation"{}},\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00039}00039\ \ \ \ \ grid\_map\_.add(\textcolor{stringliteral}{"{}variance"{}},\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00040}00040\ \ \ \ \ grid\_map\_.add(\textcolor{stringliteral}{"{}upper\_bound"{}},\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00041}00041\ \ \ \ \ grid\_map\_.add(\textcolor{stringliteral}{"{}num\_measurements"{}},\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00042}00042\ \ \ \ \ grid\_map\_.add(\textcolor{stringliteral}{"{}gradient\_magnitude"{}},\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00043}00043\ \ \ \ \ grid\_map\_.add(\textcolor{stringliteral}{"{}gradient\_x"{}},\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00044}00044\ \ \ \ \ grid\_map\_.add(\textcolor{stringliteral}{"{}gradient\_y"{}},\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00045}00045\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00046}00046\ \ \ \ \ map\_initialised\_\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00047}00047\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00048}00048\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}TerrainMap\ initialised\ at\ (\%.2f,\ \%.2f)\ with\ \%.1fm\ x\ \%.1fm\ grid\ (\%d\ x\ \%d\ cells)"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ start\_x,\ start\_y,\ initial\_physical\_size,\ initial\_physical\_size,}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(initial\_physical\_size\ /\ map\_resolution\_),}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(initial\_physical\_size\ /\ map\_resolution\_));}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00052}00052\ \ \ \ \ \mbox{\hyperlink{class_terrain_map_a2c37fa1a218a4619580380d6458111e1}{logMapBounds}}();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00053}00053\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00055}\mbox{\hyperlink{class_terrain_map_a56e0970514cfebea150832afff613ad5}{00055}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_terrain_map_a56e0970514cfebea150832afff613ad5}{TerrainMap::updateElevation}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y,\ \textcolor{keywordtype}{double}\ elevation)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00056}00056\ \ \ \ \ \textcolor{comment}{//\ Initialise\ map\ if\ this\ is\ the\ first\ update}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00057}00057\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00058}00058\ \ \ \ \ \ \ \ \ initialiseMap(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00059}00059\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00060}00060\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00061}00061\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ we\ need\ to\ expand\ the\ map}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00062}00062\ \ \ \ \ \mbox{\hyperlink{class_terrain_map_abcccf16b8f9eebdb6b10b203f93a48e0}{checkAndExpandForPosition}}(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00063}00063\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00064}00064\ \ \ \ \ \textcolor{comment}{//\ Validate\ input}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00065}00065\ \ \ \ \ \textcolor{keywordflow}{if}\ (std::isnan(elevation)\ ||\ std::isinf(elevation)\ ||\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00066}00066\ \ \ \ \ \ \ \ \ elevation\ <\ -\/100.0\ ||\ elevation\ >\ 1000.0)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00067}00067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00068}00068\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00069}00069\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00070}00070\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00071}00071\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00072}00072\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ grid\_map::Position\ position(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ grid\_map::Index\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00075}00075\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00076}00076\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!grid\_map\_.getIndex(position,\ index))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_WARN(logger\_,\ \textcolor{stringliteral}{"{}Position\ (\%.2f,\ \%.2f)\ outside\ map\ bounds"{}},\ x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00079}00079\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00080}00080\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00081}00081\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ elevation\ using\ Kalman\ filter\ approach}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.at(\textcolor{stringliteral}{"{}num\_measurements"{}},\ index)\ <\ 1.0)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ measurement}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index)\ =\ elevation;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}variance"{}},\ index)\ =\ 0.01;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}upper\_bound"{}},\ index)\ =\ elevation\ +\ 3\ *\ std::sqrt(0.01);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}num\_measurements"{}},\ index)\ =\ 1.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}First\ elevation\ measurement\ at\ (\%.2f,\ \%.2f):\ \%.2fm"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x,\ y,\ elevation);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ existing\ measurement}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ current\_elevation\ =\ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ variance\ =\ grid\_map\_.at(\textcolor{stringliteral}{"{}variance"{}},\ index);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ k\ =\ variance\ /\ (variance\ +\ 0.01);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ new\_elevation\ =\ current\_elevation\ +\ k\ *\ (elevation\ -\/\ current\_elevation);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ new\_variance\ =\ (1\ -\/\ k)\ *\ variance;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index)\ =\ new\_elevation;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}variance"{}},\ index)\ =\ new\_variance;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}upper\_bound"{}},\ index)\ =\ new\_elevation\ +\ 3\ *\ std::sqrt(new\_variance);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00103}00103\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}num\_measurements"{}},\ index)\ +=\ 1.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00104}00104\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00105}00105\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00106}00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mark\ this\ area\ as\ active\ for\ gradient\ calculation}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00107}00107\ \ \ \ \ \ \ \ \ markActiveArea(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00108}00108\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00109}00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00110}00110\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00111}00111\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00112}00112\ \ \ \ \ \ \ \ \ RCLCPP\_WARN(logger\_,\ \textcolor{stringliteral}{"{}Error\ updating\ elevation\ at\ (\%.2f,\ \%.2f):\ \%s"{}},\ x,\ y,\ e.what());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00114}00114\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00115}00115\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00117}\mbox{\hyperlink{class_terrain_map_abcccf16b8f9eebdb6b10b203f93a48e0}{00117}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_terrain_map_abcccf16b8f9eebdb6b10b203f93a48e0}{TerrainMap::checkAndExpandForPosition}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00118}00118\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00119}00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00120}00120\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00121}00121\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00122}00122\ \ \ \ \ \textcolor{keywordflow}{if}\ (needsExpansion(x,\ y))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00123}00123\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Expanding\ map\ for\ drone\ position\ (\%.2f,\ \%.2f)"{}},\ x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00124}00124\ \ \ \ \ \ \ \ \ expandMapByOneCell(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00125}00125\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00126}00126\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00128}00128\ \textcolor{keywordtype}{bool}\ TerrainMap::needsExpansion(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00129}00129\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00130}00130\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00131}00131\ \ \ \ \ grid\_map::Position\ pos(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00132}00132\ \ \ \ \ \textcolor{keywordflow}{return}\ !grid\_map\_.isInside(pos);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00133}00133\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00134}00134\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00135}00135\ \textcolor{keywordtype}{void}\ TerrainMap::expandMapByOneCell(\textcolor{keywordtype}{double}\ target\_x,\ \textcolor{keywordtype}{double}\ target\_y)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00136}00136\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00137}00137\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00138}00138\ \ \ \ \ \textcolor{comment}{//\ Get\ current\ map\ bounds}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00139}00139\ \ \ \ \ grid\_map::Position\ current\_centre\ =\ grid\_map\_.getPosition();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00140}00140\ \ \ \ \ grid\_map::Length\ current\_length\ =\ grid\_map\_.getLength();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00141}00141\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00142}00142\ \ \ \ \ \textcolor{comment}{//\ Calculate\ current\ bounds}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00143}00143\ \ \ \ \ \textcolor{keywordtype}{double}\ min\_x\ =\ current\_centre.x()\ -\/\ current\_length.x()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00144}00144\ \ \ \ \ \textcolor{keywordtype}{double}\ max\_x\ =\ current\_centre.x()\ +\ current\_length.x()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00145}00145\ \ \ \ \ \textcolor{keywordtype}{double}\ min\_y\ =\ current\_centre.y()\ -\/\ current\_length.y()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00146}00146\ \ \ \ \ \textcolor{keywordtype}{double}\ max\_y\ =\ current\_centre.y()\ +\ current\_length.y()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00147}00147\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00148}00148\ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}Current\ bounds:\ X[\%.2f\ to\ \%.2f],\ Y[\%.2f\ to\ \%.2f]"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_x,\ max\_x,\ min\_y,\ max\_y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00150}00150\ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}Target\ position:\ (\%.2f,\ \%.2f)"{}},\ target\_x,\ target\_y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00151}00151\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00152}00152\ \ \ \ \ \textcolor{comment}{//\ Determine\ expansion\ direction\ and\ new\ bounds}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00153}00153\ \ \ \ \ \textcolor{comment}{//\ Expand\ by\ exactly\ 1.0m\ in\ the\ appropriate\ direction,\ EDIT:\ Doesn't\ do\ L-\/Shape\ stuff\ will\ expand\ in\ the\ y-\/axis\ 1m\ along\ total\ x-\/legnth\ and\ vice\ versa.\ \ }}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00154}00154\ \ \ \ \ \textcolor{keywordtype}{double}\ new\_min\_x\ =\ min\_x,\ new\_max\_x\ =\ max\_x;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00155}00155\ \ \ \ \ \textcolor{keywordtype}{double}\ new\_min\_y\ =\ min\_y,\ new\_max\_y\ =\ max\_y;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00156}00156\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00157}00157\ \ \ \ \ \textcolor{keywordflow}{if}\ (target\_x\ <\ min\_x)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00158}00158\ \ \ \ \ \ \ \ \ new\_min\_x\ =\ min\_x\ -\/\ 1.0;\ \ \textcolor{comment}{//\ Expand\ west\ by\ 1m}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00159}00159\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Expanding\ WEST\ by\ 1m:\ new\_min\_x\ =\ \%.2f"{}},\ new\_min\_x);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00160}00160\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00161}00161\ \ \ \ \ \textcolor{keywordflow}{if}\ (target\_x\ >\ max\_x)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00162}00162\ \ \ \ \ \ \ \ \ new\_max\_x\ =\ max\_x\ +\ 1.0;\ \ \textcolor{comment}{//\ Expand\ east\ by\ 1m}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00163}00163\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Expanding\ EAST\ by\ 1m:\ new\_max\_x\ =\ \%.2f"{}},\ new\_max\_x);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00164}00164\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00165}00165\ \ \ \ \ \textcolor{keywordflow}{if}\ (target\_y\ <\ min\_y)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00166}00166\ \ \ \ \ \ \ \ \ new\_min\_y\ =\ min\_y\ -\/\ 1.0;\ \ \textcolor{comment}{//\ Expand\ south\ by\ 1m}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00167}00167\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Expanding\ SOUTH\ by\ 1m:\ new\_min\_y\ =\ \%.2f"{}},\ new\_min\_y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00168}00168\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00169}00169\ \ \ \ \ \textcolor{keywordflow}{if}\ (target\_y\ >\ max\_y)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00170}00170\ \ \ \ \ \ \ \ \ new\_max\_y\ =\ max\_y\ +\ 1.0;\ \ \textcolor{comment}{//\ Expand\ north\ by\ 1m}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00171}00171\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Expanding\ NORTH\ by\ 1m:\ new\_max\_y\ =\ \%.2f"{}},\ new\_max\_y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00172}00172\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00173}00173\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00174}00174\ \ \ \ \ \textcolor{comment}{//\ Calculate\ new\ map\ properties}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00175}00175\ \ \ \ \ \textcolor{keywordtype}{double}\ new\_length\_x\ =\ new\_max\_x\ -\/\ new\_min\_x;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00176}00176\ \ \ \ \ \textcolor{keywordtype}{double}\ new\_length\_y\ =\ new\_max\_y\ -\/\ new\_min\_y;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00177}00177\ \ \ \ \ \textcolor{keywordtype}{double}\ new\_centre\_x\ =\ (new\_min\_x\ +\ new\_max\_x)\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00178}00178\ \ \ \ \ \textcolor{keywordtype}{double}\ new\_centre\_y\ =\ (new\_min\_y\ +\ new\_max\_y)\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00179}00179\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00180}00180\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}New\ map:\ \%.1fm\ x\ \%.1fm\ centred\ at\ (\%.2f,\ \%.2f)"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_length\_x,\ new\_length\_y,\ new\_centre\_x,\ new\_centre\_y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00182}00182\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00183}00183\ \ \ \ \ \textcolor{comment}{//\ Create\ expanded\ map}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00184}00184\ \ \ \ \ grid\_map::GridMap\ expanded\_map;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00185}00185\ \ \ \ \ expanded\_map.setFrameId(\textcolor{stringliteral}{"{}world"{}});}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00186}00186\ \ \ \ \ expanded\_map.setGeometry(grid\_map::Length(new\_length\_x,\ new\_length\_y),\ map\_resolution\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00187}00187\ \ \ \ \ expanded\_map.setPosition(grid\_map::Position(new\_centre\_x,\ new\_centre\_y));}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00188}00188\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00189}00189\ \ \ \ \ \textcolor{comment}{//\ Add\ all\ layers}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00190}00190\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ layer\ :\ grid\_map\_.getLayers())\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00191}00191\ \ \ \ \ \ \ \ \ expanded\_map.add(layer,\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00192}00192\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00193}00193\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00194}00194\ \ \ \ \ \textcolor{comment}{//\ Copy\ existing\ data}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00195}00195\ \ \ \ \ \textcolor{keywordtype}{int}\ copied\_cells\ =\ 0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00196}00196\ \ \ \ \ \textcolor{keywordflow}{for}\ (grid\_map::GridMapIterator\ iterator(grid\_map\_);\ !iterator.isPastEnd();\ ++iterator)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00197}00197\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ grid\_map::Index\ old\_index(*iterator);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00198}00198\ \ \ \ \ \ \ \ \ grid\_map::Position\ position;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00199}00199\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00200}00200\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.getPosition(old\_index,\ position))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00201}00201\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map::Index\ new\_index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00202}00202\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (expanded\_map.getIndex(position,\ new\_index))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ layer\ :\ grid\_map\_.getLayers())\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.isValid(old\_index,\ layer))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00205}00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expanded\_map.at(layer,\ new\_index)\ =\ grid\_map\_.at(layer,\ old\_index);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ copied\_cells++;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00210}00210\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00211}00211\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00212}00212\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00213}00213\ \ \ \ \ \textcolor{comment}{//\ Update\ active\ cells\ mapping}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00214}00214\ \ \ \ \ std::set<grid\_map::Index,\ IndexComparator>\ new\_active\_cells;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00215}00215\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ old\_index\ :\ active\_cells\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00216}00216\ \ \ \ \ \ \ \ \ grid\_map::Position\ position;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00217}00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.getPosition(old\_index,\ position))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map::Index\ new\_index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (expanded\_map.getIndex(position,\ new\_index))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_active\_cells.insert(new\_index);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00222}00222\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00223}00223\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00224}00224\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00225}00225\ \ \ \ \ \textcolor{comment}{//\ Replace\ old\ map}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00226}00226\ \ \ \ \ grid\_map\_\ =\ std::move(expanded\_map);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00227}00227\ \ \ \ \ active\_cells\_\ =\ std::move(new\_active\_cells);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00228}00228\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00229}00229\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Map\ expanded\ to\ \%.1fm\ x\ \%.1fm,\ copied\ \%d\ cells"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_length\_x,\ new\_length\_y,\ copied\_cells);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00231}00231\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00232}00232\ \ \ \ \ \mbox{\hyperlink{class_terrain_map_a2c37fa1a218a4619580380d6458111e1}{logMapBounds}}();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00233}00233\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00234}00234\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00235}\mbox{\hyperlink{class_terrain_map_a604bb74394013caab47e00f9d1871c40}{00235}}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{class_terrain_map_a604bb74394013caab47e00f9d1871c40}{TerrainMap::getElevationAtPoint}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00236}00236\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00237}00237\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00238}00238\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_\ ||\ !grid\_map\_.exists(\textcolor{stringliteral}{"{}elevation"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00239}00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00240}00240\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00241}00241\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00242}00242\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00243}00243\ \ \ \ \ \ \ \ \ grid\_map::Position\ position(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00244}00244\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00245}00245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!grid\_map\_.isInside(position))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00247}00247\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00248}00248\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00249}00249\ \ \ \ \ \ \ \ \ grid\_map::Index\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00250}00250\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.getIndex(position,\ index)\ \&\&\ grid\_map\_.isValid(index,\ \textcolor{stringliteral}{"{}elevation"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00251}00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00252}00252\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00253}00253\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00254}00254\ \ \ \ \ \ \ \ \ RCLCPP\_WARN(logger\_,\ \textcolor{stringliteral}{"{}Error\ getting\ elevation\ at\ (\%.2f,\ \%.2f):\ \%s"{}},\ x,\ y,\ e.what());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00255}00255\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00256}00256\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00257}00257\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00258}00258\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00260}\mbox{\hyperlink{class_terrain_map_ad1c2ba18cd0551db76ddf04f34813a89}{00260}}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{class_terrain_map_ad1c2ba18cd0551db76ddf04f34813a89}{TerrainMap::getGradientMagnitudeAtPoint}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00261}00261\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00262}00262\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00263}00263\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_\ ||\ !grid\_map\_.exists(\textcolor{stringliteral}{"{}gradient\_magnitude"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00264}00264\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00265}00265\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00266}00266\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00267}00267\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ grid\_map::Position\ position(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00269}00269\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00270}00270\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!grid\_map\_.isInside(position))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00271}00271\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00272}00272\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00273}00273\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00274}00274\ \ \ \ \ \ \ \ \ grid\_map::Index\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00275}00275\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.getIndex(position,\ index)\ \&\&\ grid\_map\_.isValid(index,\ \textcolor{stringliteral}{"{}gradient\_magnitude"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00276}00276\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map\_.at(\textcolor{stringliteral}{"{}gradient\_magnitude"{}},\ index);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00277}00277\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00278}00278\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00279}00279\ \ \ \ \ \ \ \ \ RCLCPP\_WARN(logger\_,\ \textcolor{stringliteral}{"{}Error\ getting\ gradient\ at\ (\%.2f,\ \%.2f):\ \%s"{}},\ x,\ y,\ e.what());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00280}00280\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00281}00281\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00282}00282\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00283}00283\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00284}00284\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00285}\mbox{\hyperlink{class_terrain_map_a7bf84e5baef3b9177e82a5e94d36ec0c}{00285}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_terrain_map_a7bf84e5baef3b9177e82a5e94d36ec0c}{TerrainMap::calculateGradientsAroundPoint}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y,\ \textcolor{keywordtype}{double}\ \textcolor{comment}{/*\ radius\ */})\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00286}00286\ \ \ \ \ markActiveArea(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00287}00287\ \ \ \ \ calculateGradients();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00288}00288\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00289}00289\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00290}00290\ \textcolor{keywordtype}{void}\ TerrainMap::calculateGradients()\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00291}00291\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00292}00292\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00293}00293\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_\ ||\ active\_cells\_.empty())\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00294}00294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00295}00295\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00296}00296\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00297}00297\ \ \ \ \ \textcolor{keywordtype}{int}\ gradients\_calculated\ =\ 0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00298}00298\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00299}00299\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ index\ :\ active\_cells\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00300}00300\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!grid\_map\_.isValid(index,\ \textcolor{stringliteral}{"{}elevation"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00301}00301\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00302}00302\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00303}00303\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00304}00304\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ gradients\ using\ finite\ differences}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00305}00305\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ gradient\_x\ =\ 0.0,\ gradient\_y\ =\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00306}00306\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00307}00307\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ neighbouring\ indices}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00308}00308\ \ \ \ \ \ \ \ \ grid\_map::Index\ index\_left\ =\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00309}00309\ \ \ \ \ \ \ \ \ grid\_map::Index\ index\_right\ =\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00310}00310\ \ \ \ \ \ \ \ \ grid\_map::Index\ index\_up\ =\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00311}00311\ \ \ \ \ \ \ \ \ grid\_map::Index\ index\_down\ =\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00312}00312\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00313}00313\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Move\ indices\ with\ bounds\ checking}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00314}00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (index(1)\ >\ 0)\ index\_left(1)\ -\/=\ 1;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00315}00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (index(1)\ <\ grid\_map\_.getSize()(1)\ -\/\ 1)\ index\_right(1)\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00316}00316\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (index(0)\ >\ 0)\ index\_up(0)\ -\/=\ 1;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00317}00317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (index(0)\ <\ grid\_map\_.getSize()(0)\ -\/\ 1)\ index\_down(0)\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00318}00318\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00319}00319\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ X\ gradient}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00320}00320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.isValid(index\_left,\ \textcolor{stringliteral}{"{}elevation"{}})\ \&\&\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.isValid(index\_right,\ \textcolor{stringliteral}{"{}elevation"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ height\_left\ =\ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index\_left);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ height\_right\ =\ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index\_right);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00324}00324\ \ \ \ \ \ \ \ \ \ \ \ \ gradient\_x\ =\ (height\_right\ -\/\ height\_left)\ /\ (2.0\ *\ map\_resolution\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00325}00325\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00326}00326\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00327}00327\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ Y\ gradient}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00328}00328\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.isValid(index\_up,\ \textcolor{stringliteral}{"{}elevation"{}})\ \&\&\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.isValid(index\_down,\ \textcolor{stringliteral}{"{}elevation"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ height\_up\ =\ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index\_up);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ height\_down\ =\ grid\_map\_.at(\textcolor{stringliteral}{"{}elevation"{}},\ index\_down);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ gradient\_y\ =\ (height\_down\ -\/\ height\_up)\ /\ (2.0\ *\ map\_resolution\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00333}00333\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00334}00334\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00335}00335\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ magnitude}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00336}00336\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ gradient\_magnitude\ =\ std::sqrt(gradient\_x\ *\ gradient\_x\ +\ gradient\_y\ *\ gradient\_y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00337}00337\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00338}00338\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Validate\ and\ store}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00339}00339\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!std::isnan(gradient\_magnitude)\ \&\&\ !std::isinf(gradient\_magnitude))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00340}00340\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}gradient\_x"{}},\ index)\ =\ gradient\_x;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00341}00341\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}gradient\_y"{}},\ index)\ =\ gradient\_y;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00342}00342\ \ \ \ \ \ \ \ \ \ \ \ \ grid\_map\_.at(\textcolor{stringliteral}{"{}gradient\_magnitude"{}},\ index)\ =\ gradient\_magnitude;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ gradients\_calculated++;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00344}00344\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00345}00345\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00346}00346\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00347}00347\ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}Calculated\ gradients\ for\ \%d\ cells"{}},\ gradients\_calculated);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00348}00348\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00349}00349\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00350}00350\ \textcolor{keywordtype}{void}\ TerrainMap::markActiveArea(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00351}00351\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00352}00352\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00353}00353\ \ \ \ \ grid\_map::Position\ pos(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00354}00354\ \ \ \ \ grid\_map::Index\ index;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00355}00355\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00356}00356\ \ \ \ \ \textcolor{keywordflow}{if}\ (grid\_map\_.isInside(pos)\ \&\&\ grid\_map\_.getIndex(pos,\ index))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00357}00357\ \ \ \ \ \ \ \ \ active\_cells\_.insert(index);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00358}00358\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00359}00359\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00360}00360\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00361}\mbox{\hyperlink{class_terrain_map_ae7a49ba78b5059379de6d2fc4f16174b}{00361}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_terrain_map_ae7a49ba78b5059379de6d2fc4f16174b}{TerrainMap::isPositionInMap}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00362}00362\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00363}00363\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00364}00364\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00365}00365\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00366}00366\ \ \ \ \ grid\_map::Position\ position(x,\ y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00367}00367\ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map\_.isInside(position);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00368}00368\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00369}00369\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00370}\mbox{\hyperlink{class_terrain_map_a6e2dbce1b6b1634d0354df177b221952}{00370}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_terrain_map_a6e2dbce1b6b1634d0354df177b221952}{TerrainMap::getGridMap}}(grid\_map::GridMap\&\ map)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00371}00371\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00372}00372\ \ \ \ \ \textcolor{keywordflow}{if}\ (map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00373}00373\ \ \ \ \ \ \ \ \ map\ =\ grid\_map\_;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00374}00374\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00375}00375\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00376}00376\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00377}\mbox{\hyperlink{class_terrain_map_a048f02a382406a979a0ddc6d6b308775}{00377}}\ grid\_map\_msgs::msg::GridMap\ \mbox{\hyperlink{class_terrain_map_a048f02a382406a979a0ddc6d6b308775}{TerrainMap::getGridMapMessage}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00378}00378\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00379}00379\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00380}00380\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00381}00381\ \ \ \ \ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}TerrainMap\ not\ initialised\ -\/\ returning\ empty\ grid\ map\ message"{}});}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00382}00382\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map\_msgs::msg::GridMap();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00383}00383\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00384}00384\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00385}00385\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00386}00386\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ copy\ of\ the\ grid\ map\ for\ publishing}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00387}00387\ \ \ \ \ \ \ \ \ grid\_map::GridMap\ publish\_map\ =\ grid\_map\_;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00388}00388\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00389}00389\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ensure\ all\ cells\ have\ valid\ data\ for\ visualisation}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00390}00390\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (grid\_map::GridMapIterator\ iterator(publish\_map);\ !iterator.isPastEnd();\ ++iterator)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00391}00391\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ grid\_map::Index\ index(*iterator);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00392}00392\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00393}00393\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ empty\ elevation\ cells\ with\ 0.0\ for\ better\ visualisation}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00394}00394\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!publish\_map.isValid(index,\ \textcolor{stringliteral}{"{}elevation"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00395}00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ publish\_map.at(\textcolor{stringliteral}{"{}elevation"{}},\ index)\ =\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00397}00397\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00398}00398\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fill\ empty\ gradient\ cells}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00399}00399\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!publish\_map.isValid(index,\ \textcolor{stringliteral}{"{}gradient\_magnitude"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ publish\_map.at(\textcolor{stringliteral}{"{}gradient\_magnitude"{}},\ index)\ =\ 0.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00401}00401\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00402}00402\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00403}00403\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00404}00404\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ timestamp\ for\ RViz}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00405}00405\ \ \ \ \ \ \ \ \ publish\_map.setTimestamp(std::chrono::duration\_cast<std::chrono::nanoseconds>(}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ std::chrono::steady\_clock::now().time\_since\_epoch()).count());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00407}00407\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00408}00408\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ grid\_map\_msg\ =\ grid\_map::GridMapRosConverter::toMessage(publish\_map);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00409}00409\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00410}00410\ \ \ \ \ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}Publishing\ grid\ map:\ \%.1fm\ x\ \%.1fm\ with\ \%zu\ layers"{}},}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00411}00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ publish\_map.getLength().x(),\ publish\_map.getLength().y(),}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ publish\_map.getLayers().size());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00413}00413\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00414}00414\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *grid\_map\_msg;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00415}00415\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00416}00416\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00417}00417\ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(logger\_,\ \textcolor{stringliteral}{"{}Error\ creating\ grid\ map\ message:\ \%s"{}},\ e.what());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00418}00418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map\_msgs::msg::GridMap();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00419}00419\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00420}00420\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00421}00421\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00422}\mbox{\hyperlink{class_terrain_map_a56a17e13e2e51f8a0eb0302cad76f6a8}{00422}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_terrain_map_a56a17e13e2e51f8a0eb0302cad76f6a8}{TerrainMap::logStatistics}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00423}00423\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00424}00424\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00425}00425\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00426}00426\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}TerrainMap\ not\ yet\ initialised"{}});}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00427}00427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00428}00428\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00429}00429\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00430}00430\ \ \ \ \ grid\_map::Position\ centre\ =\ grid\_map\_.getPosition();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00431}00431\ \ \ \ \ grid\_map::Length\ length\ =\ grid\_map\_.getLength();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00432}00432\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00433}00433\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}TerrainMap\ Statistics:"{}});}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00434}00434\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}\ \ Size:\ \%.1fm\ x\ \%.1fm\ (\%.0f\ x\ \%.0f\ cells)"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00435}00435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ length.x(),\ length.y(),\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ length.x()\ /\ map\_resolution\_,\ length.y()\ /\ map\_resolution\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00437}00437\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}\ \ Centre:\ (\%.1f,\ \%.1f)"{}},\ centre.x(),\ centre.y());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00438}00438\ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}\ \ Active\ areas:\ \%zu"{}},\ active\_cells\_.size());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00439}00439\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00440}00440\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00441}\mbox{\hyperlink{class_terrain_map_a2c37fa1a218a4619580380d6458111e1}{00441}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_terrain_map_a2c37fa1a218a4619580380d6458111e1}{TerrainMap::logMapBounds}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00442}00442\ \ \ \ \ \textcolor{keywordflow}{if}\ (!map\_initialised\_)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00443}00443\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00444}00444\ \ \ \ \ grid\_map::Position\ centre\ =\ grid\_map\_.getPosition();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00445}00445\ \ \ \ \ grid\_map::Length\ length\ =\ grid\_map\_.getLength();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00446}00446\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00447}00447\ \ \ \ \ \textcolor{keywordtype}{double}\ min\_x\ =\ centre.x()\ -\/\ length.x()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00448}00448\ \ \ \ \ \textcolor{keywordtype}{double}\ max\_x\ =\ centre.x()\ +\ length.x()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00449}00449\ \ \ \ \ \textcolor{keywordtype}{double}\ min\_y\ =\ centre.y()\ -\/\ length.y()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00450}00450\ \ \ \ \ \textcolor{keywordtype}{double}\ max\_y\ =\ centre.y()\ +\ length.y()\ /\ 2.0;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00451}00451\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00452}00452\ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}Map\ bounds:\ X[\%.1f\ to\ \%.1f],\ Y[\%.1f\ to\ \%.1f]"{}},\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00453}00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_x,\ max\_x,\ min\_y,\ max\_y);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00454}00454\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00455}00455\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00456}\mbox{\hyperlink{class_terrain_map_a404a3c4a4e82d249c8f5bde2de8da230}{00456}}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_terrain_map_a404a3c4a4e82d249c8f5bde2de8da230}{TerrainMap::getActiveAreasCount}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00457}00457\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00458}00458\ \ \ \ \ \textcolor{keywordflow}{return}\ active\_cells\_.size();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00459}00459\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00460}00460\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00461}\mbox{\hyperlink{class_terrain_map_a9f1cf04648915a7c3b41d1f89c551201}{00461}}\ grid\_map::Position\ \mbox{\hyperlink{class_terrain_map_a9f1cf04648915a7c3b41d1f89c551201}{TerrainMap::getMapCentre}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00462}00462\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00463}00463\ \ \ \ \ \textcolor{keywordflow}{if}\ (map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00464}00464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map\_.getPosition();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00465}00465\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00466}00466\ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map::Position(0.0,\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00467}00467\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00468}00468\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00469}\mbox{\hyperlink{class_terrain_map_a4813792463370d6a86e4841e78a45c07}{00469}}\ grid\_map::Length\ \mbox{\hyperlink{class_terrain_map_a4813792463370d6a86e4841e78a45c07}{TerrainMap::getMapSize}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00470}00470\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00471}00471\ \ \ \ \ \textcolor{keywordflow}{if}\ (map\_initialised\_)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00472}00472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map\_.getLength();}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00473}00473\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00474}00474\ \ \ \ \ \textcolor{keywordflow}{return}\ grid\_map::Length(0.0,\ 0.0);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00475}00475\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00476}00476\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00477}\mbox{\hyperlink{class_terrain_map_a441e9a1b8e309fdbe606343bf1733fd3}{00477}}\ visualization\_msgs::msg::MarkerArray\ \mbox{\hyperlink{class_terrain_map_a441e9a1b8e309fdbe606343bf1733fd3}{TerrainMap::getGradientArrows}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00478}00478\ \ \ \ \ visualization\_msgs::msg::MarkerArray\ marker\_array;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00479}00479\ \ \ \ \ \textcolor{comment}{//\ Implementation\ for\ gradient\ visualisation}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00480}00480\ \ \ \ \ \textcolor{keywordflow}{return}\ marker\_array;}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00481}00481\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00482}00482\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00483}00483\ \textcolor{comment}{//\ Compatibility\ methods\ (kept\ for\ existing\ code)}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00484}\mbox{\hyperlink{class_terrain_map_abaf3fc40dd043de310302741c94c08d6}{00484}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_terrain_map_abaf3fc40dd043de310302741c94c08d6}{TerrainMap::setExpansionParameters}}(\textcolor{keywordtype}{double}\ \textcolor{comment}{/*\ margin\ */},\ \textcolor{keywordtype}{double}\ \textcolor{comment}{/*\ threshold\ */},\ \textcolor{keywordtype}{double}\ \textcolor{comment}{/*\ max\_size\ */})\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00485}00485\ \ \ \ \ \textcolor{comment}{//\ No\ longer\ used\ in\ incremental\ expansion,\ kept\ for\ compatibility}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00486}00486\ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}setExpansionParameters\ called\ (no\ effect\ in\ incremental\ mode)"{}});}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00487}00487\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00488}00488\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00489}\mbox{\hyperlink{class_terrain_map_aa5d96030aaf7ab1194a151660f3c21d9}{00489}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_terrain_map_aa5d96030aaf7ab1194a151660f3c21d9}{TerrainMap::setDirectionalExpansion}}(\textcolor{keywordtype}{bool}\ \textcolor{comment}{/*\ enabled\ */})\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00490}00490\ \ \ \ \ \textcolor{comment}{//\ Always\ enabled\ in\ incremental\ mode,\ kept\ for\ compatibility}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00491}00491\ \ \ \ \ RCLCPP\_DEBUG(logger\_,\ \textcolor{stringliteral}{"{}setDirectionalExpansion\ called\ (always\ enabled\ in\ incremental\ mode)"{}});}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00492}00492\ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00493}00493\ }
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00494}00494\ \textcolor{keywordtype}{void}\ TerrainMap::cleanupActiveAreas()\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00495}00495\ \ \ \ \ std::lock\_guard<std::mutex>\ lock(map\_mutex\_);}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00496}00496\ \ \ \ \ \textcolor{keywordflow}{if}\ (active\_cells\_.size()\ >\ 1000)\ \{}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00497}00497\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Keep\ only\ recent\ areas\ -\/\ implement\ cleanup\ logic\ here,\ EDIT:\ No\ need\ to\ do}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00498}00498\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(logger\_,\ \textcolor{stringliteral}{"{}Cleaning\ up\ \%zu\ active\ areas"{}},\ active\_cells\_.size());}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00499}00499\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{terrain__map_8cpp_source_l00500}00500\ \}}

\end{DoxyCode}
